<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org"
	  xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<meta charset="utf-8">
<head th:include="include :: header"></head>
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal m" id="form-balancewarning-recharge" th:object="${recharge}">
        <input id="id" name="id" type="hidden" th:field="*{id}"/>
        <div class="form-group">
            <label class="col-sm-3 control-label ">所属法人体：</label>
            <div class="col-sm-8">
                <select id="company" name="company" class="{required:true}">
                    <option value="">请选择....</option>
                </select>
            </div>
        </div>
    </form>
</div>
<div th:include="include::footer"></div>
<script type="text/javascript">

    $.ajax(
    {
        type : "POST",
        url : "/fi/orderchecking/companylist",
        dataType : "JSON",
        data : {},
        success : function(msg)
        {
            for (var i = 0; i < msg.length; i++)
            {
                $("#company").append("<option value="+msg[i].store_id+">"+msg[i].shop_name+"</option>");
            }
            if(msg.length == 0)
            {
                $("#company").append("<option value=''>请选择</option>");//添加第一个option值
                confirm("未查到任何公司信息，请联系运维人员。");
            }

        },
        error:function()
        {
            alert("获取数据失败", "error");
        }
    });


    setTimeout(function ()
    {
        $.ajax(
            {
                type : "POST",
                url : "/fi/balancewarning/getnotextinfo",
                dataType : "JSON",
                data :
                    {
                        id : $("#id").val()
                    },
                success : function(msg)
                {
                    console.log(msg);
                    $('#configname').val(msg.supplierid);
                    $('#paymethod').val(msg.paymethod);
                    $('#startTime').val(msg.startdate);
                    $('#endTime').val(msg.enddate);

                },
                error:function()
                {
                    alert("获取数据失败", "error");
                }
            });
    }, 500);



    $("#form-balancewarning-edit-store").validate({
        rules:{
            warningmoney:{
                required:true,
                number:true
            },
            monthlymoney:{
                required:true,
                number:true
            },
            storeaccount:{
                required:true,
                digits:true
            },
            contacts:{
                required:true
            },
            email:{
                required:true,
                email:true
            },
            startTime:{
                required:true
            },
            endTime:{
                required:true
            }
        },
        messages: {
            "warningmoney": {
                number: "所填金额格式不正确"
            },
            "monthlymoney": {
                number: "所填金额格式不正确"
            },
            "storeaccount": {
                digits: "所账户格式不正确"
            },
            "contacts": {
                required: "负责人必填"
            },
            "email": {
                email: "负责人邮箱可是不正确"
            },
            "startTime": {
                required: "有效起始时间必填"
            },
            "endTime": {
                required: "有效结束时间必填"
            }
        }
    });

    function submitHandler()
    {
        var suppliertype = $('#configname option:selected').val();
        var paymethod = $('#paymethod option:selected').val();
        var startTime = $('#startTime').val();
        var endTime = $('#endTime').val();
        if(suppliertype == "")
        {
            alert("请选择供应商类型");
        }
        if(paymethod == "")
        {
            alert("请选择支付方式");
        }
        if(startTime == "")
        {
            alert("请选择有效起始时间");
        }
        if(endTime == "")
        {
            alert("请选择有效结束时间");
        }
        else if ($.validate.form())
        {
            edit();
        }
    }

    function edit()
    {
        var id = $("#id").val();
        var configtype = $("#configtype").val();
        var supplierid = $('#configname option:selected').val();
        var suppliername = $('#configname option:selected').text();
        var paymethod = $('#paymethod option:selected').val();
        var warningmoney = $('#warningmoney').val();
        var monthlymoney = $('#monthlymoney').val();
        var storeaccount = $('#storeaccount').val();
        var contacts = $('#contacts').val();
        var email = $('#email').val();
        var startdate = $('#startTime').val();
        var enddate = $('#endTime').val();
        $.ajax({
            cache : true,
            type : "POST",
            url : ctx + "fi/balancewarning/editstoreconfig",
            // contentType: "application/json; charset=utf-8",
            dataType : 'json',
            // data : JSON.stringify(data),
            data : {
                "id" : id,
                "configtype" : configtype,
                "supplierid" : supplierid,
                "configname" : suppliername,
                "paymethod" : paymethod,
                "warningmoney" : warningmoney,
                "monthlymoney" : monthlymoney,
                "storeaccount" : storeaccount,
                "contacts" : contacts,
                "email" : email,
                "startdate" : startdate,
                "enddate" : enddate
            },
            async : false,
            error : function(request) {
                $.modal.alertError("系统错误");
            },
            success : function(data) {
                $.operate.saveSuccess(data);
            }
        });
    }
</script>
</body>
</html>